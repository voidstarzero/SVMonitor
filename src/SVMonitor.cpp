#include "./GLShader.hpp"
#include "./GLVertexArray.hpp"
#include "./SFMLWindow.hpp"
#include "./Shapes.hpp"
#include "./Util.hpp"

#include <GL/glew.h>

#include <SFML/System.hpp>
#include <SFML/Window.hpp>

#include <iostream>
#include <stdio.h>

const char* windowTitle = "SVMonitor";

sf::Vector2f speedo[] = {
    {50, -120}, {50, -119}, {50, -119}, {50, -118}, {50, -118}, {50, -117},
    {50, -117}, {50, -116}, {50, -116}, {50, -115}, {50, -115}, {50, -114},
    {50, -114}, {50, -113}, {50, -113}, {50, -112}, {50, -112}, {50, -111},
    {50, -111}, {50, -110}, {50, -110}, {50, -109}, {50, -109}, {50, -108},
    {50, -108}, {50, -107}, {50, -107}, {50, -106}, {50, -106}, {50, -105},
    {50, -105}, {50, -104}, {50, -104}, {50, -103}, {50, -103}, {50, -102},
    {50, -102}, {50, -101}, {50, -101}, {50, -100}, {50, -100}, {50, -99},
    {50, -99}, {50, -98}, {50, -98}, {50, -97}, {50, -97}, {50, -96},
    {50, -96}, {50, -95}, {50, -95}, {50, -94}, {50, -94}, {50, -93},
    {50, -93}, {50, -92}, {50, -92}, {50, -91}, {50, -91}, {50, -90},
    {50, -90}, {50, -89}, {50, -89}, {50, -88}, {50, -88}, {50, -87},
    {50, -87}, {50, -86}, {50, -86}, {50, -85}, {50, -85}, {50, -84},
    {50, -84}, {50, -83}, {50, -83}, {50, -82}, {50, -82}, {50, -81},
    {50, -81}, {50, -80}, {50, -80}, {50, -79}, {50, -79}, {50, -78},
    {50, -78}, {50, -77}, {50, -77}, {50, -76}, {50, -76}, {50, -75},
    {50, -75}, {50, -74}, {50, -74}, {50, -73}, {50, -73}, {50, -72},
    {50, -72}, {50, -71}, {50, -71}, {50, -70}, {50, -70}, {50, -69},
    {50, -69}, {50, -68}, {50, -68}, {50, -67}, {50, -67}, {50, -66},
    {50, -66}, {50, -65}, {50, -65}, {50, -64}, {50, -64}, {50, -63},
    {50, -63}, {50, -62}, {50, -62}, {50, -61}, {50, -61}, {50, -60},
    {50, -60}, {50, -59}, {50, -59}, {50, -58}, {50, -58}, {50, -57},
    {50, -57}, {50, -56}, {50, -56}, {50, -55}, {50, -55}, {50, -54},
    {50, -54}, {50, -53}, {50, -53}, {50, -52}, {50, -52}, {50, -51},
    {50, -51}, {50, -50}, {50, -50}, {50, -49}, {50, -49}, {50, -48},
    {50, -48}, {50, -47}, {50, -47}, {50, -46}, {50, -46}, {50, -45},
    {50, -45}, {50, -44}, {50, -44}, {50, -43}, {50, -43}, {50, -42},
    {50, -42}, {50, -41}, {50, -41}, {50, -40}, {50, -40}, {50, -39},
    {50, -39}, {50, -38}, {50, -38}, {50, -37}, {50, -37}, {50, -36},
    {50, -36}, {50, -35}, {50, -35}, {50, -34}, {50, -34}, {50, -33},
    {50, -33}, {50, -32}, {50, -32}, {50, -31}, {50, -31}, {50, -30},
    {50, -30}, {50, -29}, {50, -29}, {50, -28}, {50, -28}, {50, -27},
    {50, -27}, {50, -26}, {50, -26}, {50, -25}, {50, -25}, {50, -24},
    {50, -24}, {50, -23}, {50, -23}, {50, -22}, {50, -22}, {50, -21},
    {50, -21}, {50, -20}, {50, -20}, {50, -19}, {50, -19}, {50, -18},
    {50, -18}, {50, -17}, {50, -17}, {50, -16}, {50, -16}, {50, -15},
    {50, -15}, {50, -14}, {50, -14}, {50, -13}, {50, -13}, {50, -12},
    {50, -12}, {50, -11}, {50, -11}, {50, -10}, {50, -10}, {50, -9},
    {50, -9}, {50, -8}, {50, -8}, {50, -7}, {50, -7}, {50, -6},
    {50, -6}, {50, -5}, {50, -5}, {50, -4}, {50, -4}, {50, -3},
    {50, -3}, {50, -2}, {50, -2}, {50, -1}, {50, -1}, {50, 0},
    {50, 0}, {50, 1}, {50, 1}, {50, 2}, {50, 2}, {50, 3},
    {50, 3}, {50, 4}, {50, 4}, {50, 5}, {50, 5}, {50, 6},
    {50, 6}, {50, 7}, {50, 7}, {50, 8}, {50, 8}, {50, 9},
    {50, 9}, {50, 10}, {50, 10}, {50, 11}, {50, 11}, {50, 12},
    {50, 12}, {50, 13}, {50, 13}, {50, 14}, {50, 14}, {50, 15},
    {50, 15}, {50, 16}, {50, 16}, {50, 17}, {50, 17}, {50, 18},
    {50, 18}, {50, 19}, {50, 19}, {50, 20}, {50, 20}, {50, 21},
    {50, 21}, {50, 22}, {50, 22}, {50, 23}, {50, 23}, {50, 24},
    {50, 24}, {50, 25}, {50, 25}, {50, 26}, {50, 26}, {50, 27},
    {50, 27}, {50, 28}, {50, 28}, {50, 29}, {50, 29}, {50, 30},
    {50, 30}, {50, 31}, {50, 31}, {50, 32}, {50, 32}, {50, 33},
    {50, 33}, {50, 34}, {50, 34}, {50, 35}, {50, 35}, {50, 36},
    {50, 36}, {50, 37}, {50, 37}, {50, 38}, {50, 38}, {50, 39},
    {50, 39}, {50, 40}, {50, 40}, {50, 41}, {50, 41}, {50, 42},
    {50, 42}, {50, 43}, {50, 43}, {50, 44}, {50, 44}, {50, 45},
    {50, 45}, {50, 46}, {50, 46}, {50, 47}, {50, 47}, {50, 48},
    {50, 48}, {50, 49}, {50, 49}, {50, 50}, {50, 50}, {50, 51},
    {50, 51}, {50, 52}, {50, 52}, {50, 53}, {50, 53}, {50, 54},
    {50, 54}, {50, 55}, {50, 55}, {50, 56}, {50, 56}, {50, 57},
    {50, 57}, {50, 58}, {50, 58}, {50, 59}, {50, 59}, {50, 60},
    {50, 60}, {50, 61}, {50, 61}, {50, 62}, {50, 62}, {50, 63},
    {50, 63}, {50, 64}, {50, 64}, {50, 65}, {50, 65}, {50, 66},
    {50, 66}, {50, 67}, {50, 67}, {50, 68}, {50, 68}, {50, 69},
    {50, 69}, {50, 70}, {50, 70}, {50, 71}, {50, 71}, {50, 72},
    {50, 72}, {50, 73}, {50, 73}, {50, 74}, {50, 74}, {50, 75},
    {50, 75}, {50, 76}, {50, 76}, {50, 77}, {50, 77}, {50, 78},
    {50, 78}, {50, 79}, {50, 79}, {50, 80}, {50, 80}, {50, 81},
    {50, 81}, {50, 82}, {50, 82}, {50, 83}, {50, 83}, {50, 84},
    {50, 84}, {50, 85}, {50, 85}, {50, 86}, {50, 86}, {50, 87},
    {50, 87}, {50, 88}, {50, 88}, {50, 89}, {50, 89}, {50, 90},
    {50, 90}, {50, 91}, {50, 91}, {50, 92}, {50, 92}, {50, 93},
    {50, 93}, {50, 94}, {50, 94}, {50, 95}, {50, 95}, {50, 96},
    {50, 96}, {50, 97}, {50, 97}, {50, 98}, {50, 98}, {50, 99},
    {50, 99}, {50, 100}, {50, 100}, {50, 101}, {50, 101}, {50, 102},
    {50, 102}, {50, 103}, {50, 103}, {50, 104}, {50, 104}, {50, 105},
    {50, 105}, {50, 106}, {50, 106}, {50, 107}, {50, 107}, {50, 108},
    {50, 108}, {50, 109}, {50, 109}, {50, 110}, {50, 110}, {50, 111},
    {50, 111}, {50, 112}, {50, 112}, {50, 113}, {50, 113}, {50, 114},
    {50, 114}, {50, 115}, {50, 115}, {50, 116}, {50, 116}, {50, 117},
    {50, 117}, {50, 118}, {50, 118}, {50, 119}, {50, 119}, {50, 120},

    {50, -120}, {60, -120}, {50, -110}, {60, -110}, {50, -100}, {60, -100},
    {50, -90}, {60, -90}, {50, -80}, {60, -80}, {50, -70}, {60, -70},
    {50, -60}, {60, -60}, {50, -50}, {60, -50}, {50, -40}, {60, -40},
    {50, -30}, {60, -30}, {50, -20}, {60, -20}, {50, -10}, {60, -10},
    {50, 0}, {60, 0}, {50, 10}, {60, 10}, {50, 20}, {60, 20},
    {50, 30}, {60, 30}, {50, 40}, {60, 40}, {50, 50}, {60, 50},
    {50, 60}, {60, 60}, {50, 70}, {60, 70}, {50, 80}, {60, 80},
    {50, 90}, {60, 90}, {50, 100}, {60, 100}, {50, 110}, {60, 110},
    {50, 120}, {60, 120}
};

GLuint vPos;
GLuint sScale;
GLuint sLoc;
GLuint sRot;
GLuint color;
GLuint winSize;

void fillLocations(GLShader& program)
{
    vPos = program.attribLocation("vertexPosition");

    sScale = program.uniformLocation("shapeScale");
    glUniform2f(sScale, 1, 1);

    sLoc = program.uniformLocation("shapeLocation");
    glUniform2f(sLoc, 400, 300);

    sRot = program.uniformLocation("shapeRotation");
    glUniform1f(sRot, 0);

    color = program.uniformLocation("lineColor");
    glUniform3f(color, 1, 1, 1);

    winSize = program.uniformLocation("windowSize");
    glUniform2f(winSize, 800, 600);
}

int main()
{
    SFMLWindow window(800, 600, windowTitle);
    window.activate();

    window.clearColor(0, 0, 0);
    window.lineWidth(2);

    GLShader program = GLShader::load(
        "./res/shaders/vertex.glsl",
        "./res/shaders/fragment.glsl");
    program.use();
    fillLocations(program);

    GLVertexArray vaSpeedo(vPos, c_array_totsz(speedo), speedo);

    while (window.running())
    {
        // Do pre-frame updates
        sf::Event event;
        while (window.pollEvent(event))
        {
            if (event.type == sf::Event::Closed)
            {
                window.markStop();
            }
            else if (event.type == sf::Event::Resized)
            {
                window.resizeContext(event.size.width, event.size.height);
                glUniform2f(winSize, event.size.width, event.size.height);
            }
            else if (event.type == sf::Event::KeyPressed)
            {
                if (event.key.code == sf::Keyboard::Escape
                    || event.key.code == sf::Keyboard::Q)
                {
                    window.markStop();
                }
            }
        }

        window.clear();

        // Do rendering here
        vaSpeedo.bind();
        vaSpeedo.draw(GL_LINES, 0, c_array_nelems(speedo));

        window.display();

        // Do post-frame updates
    }

    window.close();

    return 0;
}
